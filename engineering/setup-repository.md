# Repository setup

How we expect projects to be setup at Dwarves Foundation.

## What we expect

- [README.md](/engineering/readme-how.md) in the root of the repo is the docs
- Single command run
- (Optional) Single command deploy
- [Repeatable and re-creatable builds](https://martinfowler.com/bliki/ReproducibleBuild.html). The good news is that [Go builds are reproducible by default](https://blog.filippo.io/reproducing-go-binaries-byte-by-byte/)
- (Optional) Build artifacts bundle a ["Bill of Materials"](/engineering/backend.md#bill-of-materials). If the product is web-based, perhaps it does not seem as critical to you to have a BoM. However, many of customers create embedded products that need to be supported, and updateable, for many years. In this instance, if you find that you have to support certain releases for long periods of time, then creating a BoM for your each release could prove a useful experience

### Technical

Project setup must be self-contained, no *"It works on my machine"* bullshit. If its failed to run the setup script on your coworker's machine, it needs a fix ðŸ”§

Every Backend codebase should have:
- `make dep` to install all dependencies
- [`make run`](https://github.com/huygn/stringsvc/blob/master/Makefile#L20-L21) to run the app in dev mode
- `make build` to compile for production

Every Frontend codebase should have:
- [`.nvmrc`](https://github.com/creationix/nvm#nvmrc) file to lock down the Nodejs version being used
- `yarn install` to install all dependencies
- `yarn start` to start development server
- `yarn build` to compile for production
- `yarn serve` to run/serve the compiled output

### Deployment

All engineers should be aware about deployment and how your application would behave/run on a cloud environment. At minimal, Backend/Frontend apps must be cloud-friendly:

- Every project must have a ready-to-deploy [Dockerfile](https://docs.docker.com/engine/reference/builder/), and all environment variables must be configurable .ie:
  ```sh
  $ docker build --build-arg API_ENDPOINT=http://localhost:9000  -t dwarvesf/fortress-web .
  ```
- Every Backend source code must have a healthcheck endpoint (`/api/health` for example)

### Documentation

At minimal:

- How to install/run/build/deploy the source code
- Required environment variables / configurations

Nice to have:

- Architecture diagram - if this is a complex application that contains more than one service (micro-services) or involves integrating with several 3rd party services
- Technical decisions - .ie why you chose this library over that 10k-stars-github-repo library? It would be really helpful to new comers as they go through the source code

## Git Configuration
Git configuration always comes along with the repository initialization. 

**Setup your Gitignore**

The .gitignore file is meant to be a list of files that Git should not track. It resides at the root directory of your repository. It can be a list of file path relative to the repository, or a list of wildcard

We believe the community has been devoted to share the common practice. Please go to http://gitignore.io/, select your stack and use the file for your project. Beside the tool, we also recommend Gophers not to add the `/vendor/` to the gitignore. The vendors might affect the reproducible builds.

**Keep the gitignore file clean**

You realize that your directory is cluttered with temporary files. It might be from your build system, your editors or some test files they wrote.

So what do you (often but incorrectly) do? You add those files to .gitignore for their project. You end up with a .gitignore file that contains entries like

```
*~
.vscode
*.DS_Store
.idea
```
With that, you're sure to ignore backup files from vim, folders from MacOS and temporary files from Visual Studio code, etc.
**Don't do this**. Not everybody uses your editor or favorite pet tool, and nobody cares. The repository you're working in is shared with a lot of others developers. Sending pull requests to just add this kind of entry to ignore files generated by your pet editor is wrong and annoying

Instead, Git has a global ignore file that works for EVERY repository on your system. No need to hack each repository. By default, it's in `~/.config/git/ignore`

**Setup remote repositories if you wish to push the code to multiple repos (e.g for client and internal use)**

**Set up default branch, protected branches, git rules**

## Best practices

- We recommend [Docker Compose](https://docs.docker.com/compose/) to make setting up a project on a new development machine fast and easy
- Your `docker-compose.yml` file should cover everything your app needs to function properly, including database and migrations. This also ensures everyone is locked on the same Go/Nodejs/Clojure/.etc version
- For Golang projects, leverage Docker Compose to build & run your app in Alpine/Linux environment, this ensures your app shall work correctly when deployed to the cloud
- Avoid putting secrets in the source code. Those should be stored in environment variables to make it configurable in CI/CD pipelines as well as deployment process
